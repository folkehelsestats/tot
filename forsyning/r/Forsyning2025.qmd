---
title: "Forsyningsundersøkelsen tall fra 2025"
format: html
editor: visual
---

```{r}
#| include: false
#| echo: false
#| output: false
#| message: false
#| 
# Importere fil, konvertere til data.table og lage kodebok
Sys.setlocale("LC_ALL", "nb-NO.UTF-8")


library(data.table)
library(haven)
library(labelled)
library(DT)
library(skimr)
library(ggplot2)

# For ? lage codebook fra Yusmans kode:
source("https://raw.githubusercontent.com/folkehelsestats/rusus/refs/heads/main/fun-codebook.R")

# Importere data med og uten labels:
for_2025 <- read_sav("O:/Prosjekt/Rusdata/Forsyningsundersokelsen/Data_Forsyn_2015_2024/FU_veid_2015_2025.sav")

#dt <- as.data.table(for_2025) # Gjør datasettet til data.table


# Behold labels som attributter i dt-settet.
# Variabel-labels:
var_labels <- sapply(for_2025, function(x) attr(x, "label"))
# Test
# Verdilabels (for kategoriske variabler):
val_labels <- lapply(for_2025, function(x) attr(x, "labels"))

# Sjekk labels
print(var_labels)
print(val_labels)

# konverter alle labelled variabler til faktor med labels:
# dt[] <- lapply(dt, to_factor)  


```

```{r}
#| echo: false
#| include: false
#| output: false
#| message: false

# Opprette variabler, endre navn og fjerner inivider <16 år og >74 år

# år, måned, dag:
setDT(for_2025)

for_2025[, Astartdato.1 := as.Date(as.character(Astartdato.1), format = "%Y%m%d")]

for_2025[, `:=`(
  aar   = year(Astartdato.1),
  maned = month(Astartdato.1),
  dag   = mday(Astartdato.1)
)]

table(for_2025$aar)

# dt[, Astartdato1 := as.Date(as.character(Astartdato1), format = "%Y%m%d")]

# dt[, `:=`(
#  aar   = year(Astartdato1),
#  maned = month(Astartdato1),
#  dag   = mday(Astartdato1)
# )]

# Alder og kjønn
setnames(for_2025, old = c("Aalder.1", "Akjonn"), new = c("alder", "kjonn"))
# setnames(dt, old = c("Aalder.1", "Akjonn"), new = c("alder", "kjonn"))

#Spredning av alder:
summary(for_2025$alder)

  # Fjern rader der kjonn er NA
  for_2025 <- for_2025[!is.na(kjonn)] # !is.na(kjonn) fjerner rader med manglende verdi i kjonn.
 # dt <- dt[!is.na(kjonn)] # !is.na(kjonn) fjerner rader med manglende verdi i kjonn.

  # Fjern rader der alder > 74
  for_2025 <- for_2025[alder <= 74]
#  dt[, alder := as.integer(as.character(alder))]
  
  # Fjern rader der alder < 16 - velger å beholde 16 eller høyere:
  for_2025 <- for_2025[alder >= 16]

 # dt <- dt[alder >= 16 & alder <= 74]

  # Alder i 4 grupper
  # 1. Lag ny variabel alder_4 (4-aldersgrupper) med NA som utgangspunkt
  for_2025[, alder_4 := NA_integer_] # NA_integer_ sikrer at alder_4 starter som numerisk.
  
  # 2. Sett alder_4 = alder hvis alder > 15 & alder < 75
  for_2025[alder > 15 & alder < 75, alder_4 := alder]
  
  # 3. Recode til grupper (bytter alderen med tall 1-4)
  for_2025[alder_4 %between% c(16, 24), alder_4 := 1]
  for_2025[alder_4 %between% c(25, 49), alder_4 := 2]
  for_2025[alder_4 %between% c(50, 64), alder_4 := 3]
  for_2025[alder_4 %between% c(65, 74), alder_4 := 4]
  
  # 4. Lag labels som en faktor
  for_2025[, alder_4 := factor(alder_4,
                         levels = 1:4,
                         labels = c("16-24", "25-49", "50-64", "65-74"))]
  
  # Alder i 6 grupper (med 10 år)
  # 1. Lag ny variabel alder_10 (6 aldersgrupper) med NA som utgangspunkt
  for_2025[, alder_10 := NA_integer_]
  
  # 2. Sett alder_10 = alder hvis alder > 15 & alder < 75
  for_2025[alder > 15 & alder < 75, alder_10 := alder]
  
  # 3. Recode til grupper (bytter alderen med tall 1-4)
  for_2025[alder_10 %between% c(16, 25), alder_10 := 1]
  for_2025[alder_10 %between% c(26, 35), alder_10 := 2]
  for_2025[alder_10 %between% c(36, 45), alder_10 := 3]
  for_2025[alder_10 %between% c(46, 55), alder_10 := 4]
  for_2025[alder_10 %between% c(56, 65), alder_10 := 5]
  for_2025[alder_10 %between% c(66, 75), alder_10 := 6]
  
  # 4. Lag labels som en faktor
  for_2025[, alder_10 := factor(alder_10,
                         levels = 1:6,
                         labels = c("16-25", "26-35", "36-45", "46-55", "56-65", "66-75"))]
  
table(for_2025$alder_4)

```

# Fordeling av forsyningskilder for sigaretter og snus

De årlige røykevaneundersøkelsene fra Statistisk sentralbyrå har fra 1990 til 2014 inkludert spørsmål til dagligrøykere om opprinnelsesland for siste døgns sigarettforbruk. Fra 2015 overtok Ipsos oppgaven med å kartlegge forsyningskilder, på vegne av FHI, og undersøkelsene ble samtidig utvidet til å omfatte snus og e-sigaretter. <https://www.fhi.no/le/royking/tobakkinorge/bruk-av-tobakk/nikotinmarkedets-sammensetning-og-endring/#kjp-av-tobakk-fra-uregistrerte-forsyningskilder> Fra 2025 har Helsedirektoratet overtatt innkjøp av undersøkelsen, som fortsatt gjennomføres av Ipsos.

Undersøkelsen gjennomføres ved at Ipsos sender undersøkelsen til medlemmer av Ipsos Webpanel i alderen 15 eller mer, både via sms, e-post og telefon. Undersøkelsen sendes ut hver uke gjennom hele året og antallet respondenter som svarer på undersøkelsen varierer. Tre til fire ganger i året sammenliknes demografiske markører ved utvalget og befolkningen. I tilfelle noen grupper er over/underrepresentert sendes det ut flere invitasjoner til de gruppene som kan kompensere for skjevfordelingen. En detaljert beskrivelse av utvalgsprosedyren ligger på Ipsos nettsider (<https://w.ipsos.no/bild/forsyningsundersokelsen.pdf>).

## E-sigaretter per 2025

Det er forbudt å importere og selge e-sigaretter og e-væske med nikotin i Norge. Det er vedtatt nye regler som vil tillate salg av e-sigaretter med nikotin, men de nye reglene har ikke tredd i kraft i Norge ennå. I EU er det lov å selge med nikotin, med en maksimumsgrense på 20 mg/ml. Fra 1. juli 2024 er det ikke tillatt med andre smaker enn tobakk i e-sigaretter og e-væske/e-juice solgt i Norge.

Privatpersoner som ønsker å bruke e-sigaretter med nikotin som røykeavvenningsprodukt kan importere disse fra utlandet som legemiddel.

E-sigaretter med nikotin er forbudt å selge i Norge. Elektroniske sigaretter uten nikotin kan selges med 18-årsgrense, men omfattes av reklame- og oppstillingsforbud. Det er mulighet for privatimport gjennom legemiddellovgivning.

<https://www.helsedirektoratet.no/forebygging-diagnose-og-behandling/forebygging-og-levevaner/tobakk/e-sigaretter-elektroniske-sigaretter-og-regelverk>

## Om tallene

I tallene om forsyning benyttes kun data om forsyningskilder fra individer som oppgir at de røyker eller snuser daglig. Til forskjell fra FHIs publikasjoner om forsyningskilder har vi ikke gruppert noen av kategoriene til forsyningskilder. F.eks. er røyk kjøpt i butikk og på nett i Norge to ulike kategorier, i stedet for at tallene presenteres samlet som "Norge" (som FHI gjør). Dette gjør at alle tallene ikke er direkte sammenliknbare.

```{r}
#| echo: false
#| include: false
#| output: false
#| message: false

# Oppretter variabler om beskrivelse av vaner (daglig, av-og-til, tidligere, aldri) for røyk, snus og damp: 

for_2025[, royk := Aq1]
for_2025[, snus := Aq2]
for_2025[, damp := Aq3]

# Ser på antall, inkl. med missing:
table(for_2025$royk)
table(for_2025$royk, useNA = "ifany") # med missing
# Vær obs på at det for årene 2021 og 2023 er en del som har missing på alle variabler

# røykevaner per år
for_2025[, table(aar, royk)]

# Røyk
for_2025[, royk_3 := factor(fcase(
  Aq1 == 1, "Daglig",
  Aq1 %in% 2:3, "Av og til",
  Aq1 %in% 4:6, "Tidligere/aldri",
  default = NA_character_
), levels = c("Daglig", "Av og til", "Tidligere/aldri"))]

# Sjekker antall og missing:
table(for_2025$royk_3)
table(for_2025$royk_3, useNA = "ifany")

for_2025[, royk_4 := factor(fcase(
  Aq1 == 1, "Daglig",
  Aq1 %in% 2:3, "Av og til",
  Aq1 %in% 4:5, "Tidligere",
  Aq1 == 6, "Aldri",
  default = NA_character_
), levels = c("Daglig", "Av og til", "Tidligere", "Aldri"))]


for_2025[, royk_5 := factor(fcase(
  Aq1 == 1, "Daglig",
  Aq1 %in% 2:3, "Av og til",
  Aq1 %in% 4, "Daglig-Tidligere",
  Aq1 %in% 5, "Avogtil-Tidligere",
  Aq1 == 6, "Aldri",
  default = NA_character_
), levels = c("Daglig", "Av og til", "Daglig-Tidligere", "Avogtil-Tidligere", "Aldri"))]

# Snus:
for_2025[, snus_3 := factor(fcase(
  Aq2 == 1, "Daglig",
  Aq2 %in% 2:3, "Av og til",
  Aq2 %in% 4:6, "Tidligere/aldri",
  default = NA_character_
), levels = c("Daglig", "Av og til", "Tidligere/aldri"))]

for_2025[, snus_4 := factor(fcase(
  Aq2 == 1, "Daglig",
  Aq2 %in% 2:3, "Av og til",
  Aq2 %in% 4:5, "Tidligere",
  Aq2 == 6, "Aldri",
  default = NA_character_
), levels = c("Daglig", "Av og til", "Tidligere", "Aldri"))]


# Damp:
for_2025[, damp_3 := factor(fcase(
  Aq3 == 1, "Daglig",
  Aq3 %in% 2:3, "Av og til",
  Aq3 %in% 4:6, "Tidligere/aldri",
  default = NA_character_
), levels = c("Daglig", "Av og til", "Tidligere/aldri"))]

for_2025[, damp_4 := factor(fcase(
  Aq3 == 1, "Daglig",
  Aq3 %in% 2:3, "Av og til",
  Aq3 %in% 4:5, "Tidligere",
  Aq3 == 6, "Aldri",
  default = NA_character_
), levels = c("Daglig", "Av og til", "Tidligere", "Aldri"))]



## Forekomst av røyk/snus/damp vaner over år:
library(gt) 

# Røyk: 
  # 1) Tell antall per aar og kategori (inkluder NA i antall)
  tab_royk3 <- for_2025[!is.na(royk_3), .N, by = .(aar, royk_3)]
  
  # 2) Beregn prosent per aar, ekskluder NA fra beregning
  tab_royk3[, pct := round(100 * N / sum(N), 1), by = aar]
  
  # 3) Lag bred tabell med både antall og prosent
  # Først antall
  wide_N <- dcast(tab_royk3, aar ~ royk_3, value.var = "N", fill = 0)
  setnames(wide_N, old = setdiff(names(wide_N), "aar"),
           new = paste0("n_", setdiff(names(wide_N), "aar")))
  
  # Så prosent
  wide_pct <- dcast(tab_royk3, aar ~ royk_3, value.var = "pct", fill = 0)
  setnames(wide_pct, old = setdiff(names(wide_pct), "aar"),
           new = paste0("pct_", setdiff(names(wide_pct), "aar")))
  
  # 4) Slå sammen antall og prosent
  krysstab__royk3 <- merge(wide_N, wide_pct, by = "aar")
  
  # Se resultat
  # krysstab__royk3[]

  # Snus:
  
    # 1) Tell antall per aar og kategori (inkluder NA i antall)
  tab_snus3 <- for_2025[!is.na(snus_3), .N, by = .(aar, snus_3)]
  
  # 2) Beregn prosent per aar, ekskluder NA fra beregning
  tab_snus3[, pct := round(100 * N / sum(N), 1), by = aar]
  
  # 3) Lag bred tabell med både antall og prosent
  # Først antall
  wide_N <- dcast(tab_snus3, aar ~ snus_3, value.var = "N", fill = 0)
  setnames(wide_N, old = setdiff(names(wide_N), "aar"),
           new = paste0("n_", setdiff(names(wide_N), "aar")))
  
  # Så prosent
  wide_pct <- dcast(tab_snus3, aar ~ snus_3, value.var = "pct", fill = 0)
  setnames(wide_pct, old = setdiff(names(wide_pct), "aar"),
           new = paste0("pct_", setdiff(names(wide_pct), "aar")))
  
  # 4) Slå sammen antall og prosent
  krysstab__snus3 <- merge(wide_N, wide_pct, by = "aar")
  
  # Se resultat
 #  krysstab__snus3[]
  
  
   # Damp:
  
    # 1) Tell antall per aar og kategori (inkluder NA i antall)
  tab_damp3 <- for_2025[!is.na(damp_3), .N, by = .(aar, damp_3)]
  
  # 2) Beregn prosent per aar, ekskluder NA fra beregning
  tab_damp3[, pct := round(100 * N / sum(N), 1), by = aar]
  
  # 3) Lag bred tabell med både antall og prosent
  # Først antall
  wide_N <- dcast(tab_damp3, aar ~ damp_3, value.var = "N", fill = 0)
  setnames(wide_N, old = setdiff(names(wide_N), "aar"),
           new = paste0("n_", setdiff(names(wide_N), "aar")))
  
  # Så prosent
  wide_pct <- dcast(tab_damp3, aar ~ damp_3, value.var = "pct", fill = 0)
  setnames(wide_pct, old = setdiff(names(wide_pct), "aar"),
           new = paste0("pct_", setdiff(names(wide_pct), "aar")))
  
  # 4) Slå sammen antall og prosent
  krysstab__damp3 <- merge(wide_N, wide_pct, by = "aar")
  
  # Se resultat
 # krysstab__damp3[]

```

##### Bruk av røyk over tid i undersøkelsen

`r gt(krysstab__royk3)`

Antall som røyker daglig over tid har sunket. Tabell over viser forekomst av røykevaner blant utvalget per år (i antall og prosent).

##### Bruk av snus over tid i undersøkelsen

`r gt(krysstab__snus3)`

Antall som snuser daglig har variert mellom 1099-2187 i utvalget i perioden 2015-2025. Se tall med forekomst av snusbruk i tabell over.

##### Bruk av e-sigaretter over tid i undersøkelsen

`r gt(krysstab__damp3)`

Antall som har brukt e-sigaretter daglig har variert mellom 98-186 stykker i utvalget, og andelen som bruker e-sigaretter daglig har ligget på om lag 1 %. Se detaljer i tabellen over.

## Forsyningskilder sigaretter

Fordelingen av forsyningskilder for sigaretter i perioden 2015-2025 er vist i figuren under.

```{r}
#| include: false
#| echo: false
#| output: false
#| message: false

# Lager datasett med kun dagliggøykere som og rapporterer ? ha r?kt siste 24t.
  # OBS. Indivder >74 og <16 er allerede fjernet fra for_2025, hvis ikke m? de fjernes her.


# Variabelnavnene du vil beholde
vars_royk <- c(
  "kjonn","alder","Aq1",
  "As1.1","As1.2","As1.3","As1.4","As1.5","As1.6","As1.7","As1.8","As1.9",
  "As2.1","As2.2","As2.3","As2.4","As2.5","As2.6","As2.7","As2.8",
  "W1","aar","alder_4"
)

# Lag nytt datasett med filtrering og variabelutvalg
forroyk <- for_2025[Aq1 == 1, ..vars_royk]


# Variablene som skal summeres (antall røyk fra ulike kilder)
sum_vars_royk <- c("As2.1","As2.2","As2.3","As2.4","As2.5","As2.6","As2.7","As2.8")

# Sørg for numerisk og lag totnroyk
forroyk[, (sum_vars_royk) := lapply(.SD, function(x) as.numeric(as.character(x))), .SDcols = sum_vars_royk]
forroyk[, totnroyk := rowSums(.SD, na.rm = TRUE), .SDcols = sum_vars_royk]

# Bygg tabellen: summer per ?r, N, og andeler
sum_royk_year <- forroyk[
  ,
  {
    # summer komponentene
    comp_sums <- lapply(.SD, function(x) sum(x, na.rm = TRUE))
    # sum totnroyk
    tot_sum <- sum(totnroyk, na.rm = TRUE)
    # N: antall individer med >0 p? minst ?n As-variabel
    N_val <- sum(rowSums(.SD, na.rm = TRUE) > 0)

    # andeler i prosent (uavrundet)
    # beskytter mot tot_sum==0
    if (tot_sum == 0) {
      andeler <- list(
        nor=0, taxfree=0, smu=0, sverige=0, danmark=0, utland=0, nor_nett=0, utland_nett=0
      )
    } else {
      andeler <- list(
        nor          = 100 * comp_sums$As2.1 / tot_sum,
        taxfree      = 100 * comp_sums$As2.2 / tot_sum,
        smu          = 100 * comp_sums$As2.3 / tot_sum,
        sverige      = 100 * comp_sums$As2.4 / tot_sum,
        danmark      = 100 * comp_sums$As2.5 / tot_sum,
        utland       = 100 * comp_sums$As2.6 / tot_sum,
        nor_nett     = 100 * comp_sums$As2.7 / tot_sum,
        utland_nett  = 100 * comp_sums$As2.8 / tot_sum
      )
    }

    c(comp_sums, list(N = N_val, sum_totnroyk = tot_sum), andeler)
  },
  by = aar,
  .SDcols = sum_vars_royk
][order(aar)]

## Figur p? forsyning av sigaretter over tid:
library(highcharter)


# Sikre data.table
dt <- as.data.table(sum_royk_year)

# S?rg for at aar er numerisk (for riktig sortering og akse)
if (!is.numeric(dt$aar)) dt[, aar := as.integer(aar)]
setorder(dt, aar)

# Definer rekkef?lge og etiketter
andel_cols <- c("nor","taxfree","smu","sverige","danmark","utland","nor_nett","utland_nett")
labels_map <- c(
  nor = "Norge (butikk)",
  taxfree = "Taxfree",
  smu = "Smuglevare",
  sverige = "Sverige (butikk)",
  danmark = "Danmark (butikk)",
  utland = "Utland",
  nor_nett = "Norge (nett)",
  utland_nett = "Utland (nett)"
)

# (Valgfritt) Egendefinerte farger per serie
cols <- c(
  nor = "#025169",
  taxfree = "#0069E8",
  smu = "#7C145C",
  sverige = "#047FA4",
  danmark = "#C68803",
  utland = "#38A389",
  nor_nett = "#6996CE",
  utland_nett = "#366558"
)



# Start tomt highchart-objekt (riktig funksjon!)
h <- highchart() %>%
  hc_chart(type = "spline") %>%
  hc_title(text = "Fordeling av siste døgns sigarettforbruk blant dagligrøykere fra ulike kilder") %>%
  hc_subtitle(text = "Fordeling av forsyningskilder til sigaretter over tid") %>%
  hc_xAxis(
   # title = list(text = "?r"),
    categories = dt$aar,
    tickmarkPlacement = "on"
  ) %>%
  hc_yAxis(
  # title = list(text = "Andel (%)"),
    labels = list(format = "{value}%"),
    min = 0
  ) %>%
  hc_tooltip(shared = TRUE, valueSuffix = " %") %>%
  hc_legend(align = "center", verticalAlign = "bottom") %>%
  hc_exporting(enabled = TRUE) %>%
  hc_credits(enabled = FALSE)

# Legg til serier
for (nm in andel_cols) {
  h <- h %>% hc_add_series(
    name   = labels_map[[nm]],
    data   = dt[[nm]],     # r?data, uavrundet
    color  = cols[[nm]],
    marker = list(enabled = TRUE, radius = 3),
    tooltip = list(valueDecimals = 2)  # kun visning
  )
}

h

# Tabell med tall over:

royk_uvektet <- gt(dt) |>  tab_header(title = "Forsyningskilder sigaretter") |> fmt_number(columns = c(nor, taxfree, smu, sverige, danmark, utland, nor_nett, utland_nett), decimals = 1) |> cols_label(aar = "År", As2.1 = "Norge (butikk)", As2.2 = "Taxfree", As2.3 = "Smuglevare", As2.4 = "Sverige (butikk)", As2.5 = "Danmark (butikk)", As2.6 = "Utland", As2.7 = "Norge (nett)", As2.8 = "Utland (nett)", sum_totnroyk = "N røyk")

## Vektede tall:

# Vektede summer per år

sum_royk_year_w <- forroyk[
  ,
  {
    w <- W1
    comp_sums_w <- lapply(.SD, function(x) sum(x * w, na.rm = TRUE))
    tot_sum_w   <- sum(totnroyk * w, na.rm = TRUE)
    N_val       <- sum(rowSums(.SD, na.rm = TRUE) > 0)  # evt. vektet N er ikke standard

    if (tot_sum_w == 0) {
      andeler_w <- list(
        nor=0, taxfree=0, smu=0, sverige=0, danmark=0, utland=0, nor_nett=0, utland_nett=0
      )
    } else {
      andeler_w <- list(
        nor          = 100 * comp_sums_w$As2.1 / tot_sum_w,
        taxfree      = 100 * comp_sums_w$As2.2 / tot_sum_w,
        smu          = 100 * comp_sums_w$As2.3 / tot_sum_w,
        sverige      = 100 * comp_sums_w$As2.4 / tot_sum_w,
        danmark      = 100 * comp_sums_w$As2.5 / tot_sum_w,
        utland       = 100 * comp_sums_w$As2.6 / tot_sum_w,
        nor_nett     = 100 * comp_sums_w$As2.7 / tot_sum_w,
        utland_nett  = 100 * comp_sums_w$As2.8 / tot_sum_w
      )
    }

    c(comp_sums_w, list(N = N_val, sum_totnroyk = tot_sum_w), andeler_w)
  },
  by = aar,
  .SDcols = sum_vars_royk]



# --- Vektet figur: andeler over tid (fra sum_royk_year_w) ---

# Sikre data.table og ?r som numerisk
dt_w <- as.data.table(sum_royk_year_w)
if (!is.numeric(dt_w$aar)) dt_w[, aar := as.integer(aar)]
setorder(dt_w, aar)


# Start tomt highchart-objekt
h_w <- highchart() %>%
  hc_chart(type = "spline") %>%
  hc_title(text = "Fordeling av siste døgns sigarettforbruk (vektet) blant dagligrøykere fra ulike kilder") %>%
  hc_subtitle(text = "Vektede andeler av forsyningskilder til sigaretter over tid") %>%
  hc_xAxis(
    categories = dt_w$aar,
    tickmarkPlacement = "on"
  ) %>%
  hc_yAxis(
    labels = list(format = "{value}%"),
    min = 0
  ) %>%
  hc_tooltip(shared = TRUE, valueSuffix = " %") %>%
  hc_legend(align = "center", verticalAlign = "bottom") %>%
  hc_exporting(enabled = TRUE) %>%
  hc_credits(enabled = FALSE)

# Legg til ?n serie per kilde
for (nm in andel_cols) {
  h_w <- h_w %>% hc_add_series(
    name   = labels_map[[nm]],
    data   = dt_w[[nm]],     # r?data, uavrundet
    color  = cols[[nm]],
    marker = list(enabled = TRUE, radius = 3),
    tooltip = list(valueDecimals = 2)  # kun visning
  )
}

# Vis figuren
h_w

dt_filtered <- dt_w[, !names(dt_w) %in% paste0("As", 2.1:2.8), with = FALSE]

# Tall til figuren over:
royk_vektet <- gt(dt_filtered) |>  tab_header(title = "Forsyningskilder sigaretter vektet") |> fmt_number(columns = c(nor, taxfree, smu, sverige, danmark, utland, nor_nett, utland_nett), decimals = 1) |> cols_label(aar = "År", nor = "Norge (butikk)", taxfree = "Taxfree", smu = "Smuglevare", sverige = "Sverige (butikk)", danmark = "Danmark (butikk)", utland = "Utland", nor_nett = "Norge (nett)", utland_nett = "Utland (nett)", sum_totnroyk = "N røyk")


```

#### Figur: Prosentandel av siste døgns sigarettforbruk blant dagligrøykere som ble kjøpt fra ulike kilder (uvektet), 2015-2025, personer i alderen 16-74 år.

`r h`

#### Figur A: Prosentandel av siste døgns sigarettforbruk blant dagligrøykere som ble kjøpt fra ulike kilder (vektet), 2015-2025, personer i alderen 16-74 år.

`r h_w`

## Forsyningskilder snus

Fordelingen av forsyningskilder for snus i perioden 2015-2025 er vist i figuren under.

```{r}
#| include: false
#| echo: false
#| output: false
#| message: false

# Lager datasett med kun dagliggøykere som og rapporterer ? ha røkt siste 24t.
  # OBS. Indivder >74 og <16 er allerede fjernet fra for_2025, hvis ikke m? de fjernes her.


# Variabelnavnene du vil beholde
vars_snus <- c(
  "kjonn","alder","Aq2",
  "An1.1","An1.2","An1.3","An1.4","An1.5","An1.6","An1.7","An1.8","An1.9",
  "An2.1","An2.2","An2.3","An2.4","An2.5","An2.6","An2.7","An2.8",
  "W1","aar","alder_4"
)

# Lag nytt datasett med filtrering og variabelutvalg
forsnus <- for_2025[Aq2 == 1, ..vars_snus]


# Variablene som skal summeres (antall snus fra ulike kilder)
sum_vars_snus <- c("An2.1","An2.2","An2.3","An2.4","An2.5","An2.6","An2.7","An2.8")

# Sørg for numerisk og lag totnroyk
forsnus[, (sum_vars_snus) := lapply(.SD, function(x) as.numeric(as.character(x))), .SDcols = sum_vars_snus]
forsnus[, totnsnus := rowSums(.SD, na.rm = TRUE), .SDcols = sum_vars_snus]

# Bygg tabellen: summer per ?r, N, og andeler
sum_snus_year <- forsnus[
  ,
  {
    # summer komponentene
    comp_sums <- lapply(.SD, function(x) sum(x, na.rm = TRUE))
    # sum totnroyk
    tot_sum <- sum(totnsnus, na.rm = TRUE)
    # N: antall individer med >0 p? minst ?n As-variabel
    N_val <- sum(rowSums(.SD, na.rm = TRUE) > 0)

    # andeler i prosent (uavrundet)
    # beskytter mot tot_sum==0
    if (tot_sum == 0) {
      andeler <- list(
        nor=0, taxfree=0, smu=0, sverige=0, danmark=0, utland=0, nor_nett=0, utland_nett=0
      )
    } else {
      andeler <- list(
        nor          = 100 * comp_sums$An2.1 / tot_sum,
        taxfree      = 100 * comp_sums$An2.2 / tot_sum,
        smu          = 100 * comp_sums$An2.3 / tot_sum,
        sverige      = 100 * comp_sums$An2.4 / tot_sum,
        danmark      = 100 * comp_sums$An2.5 / tot_sum,
        utland       = 100 * comp_sums$An2.6 / tot_sum,
        nor_nett     = 100 * comp_sums$An2.7 / tot_sum,
        utland_nett  = 100 * comp_sums$An2.8 / tot_sum
      )
    }

    c(comp_sums, list(N = N_val, sum_totnsnus = tot_sum), andeler)
  },
  by = aar,
  .SDcols = sum_vars_snus
][order(aar)]

## Figur p? forsyning av snus over tid:
library(highcharter)
library(dplyr)


# Sikre data.table
dt_snus <- as.data.table(sum_snus_year)

# S?rg for at aar er numerisk (for riktig sortering og akse)
if (!is.numeric(dt_snus$aar)) dt_snus[, aar := as.integer(aar)]
setorder(dt_snus, aar)

# Definer rekkef?lge og etiketter
andel_cols <- c("nor","taxfree","smu","sverige","danmark","utland","nor_nett","utland_nett")
labels_map <- c(
  nor = "Norge (butikk)",
  taxfree = "Taxfree",
  smu = "Smuglevare",
  sverige = "Sverige (butikk)",
  danmark = "Danmark (butikk)",
  utland = "Utland",
  nor_nett = "Norge (nett)",
  utland_nett = "Utland (nett)"
)

# (Valgfritt) Egendefinerte farger per serie
cols <- c(
  nor = "#025169",
  taxfree = "#0069E8",
  smu = "#7C145C",
  sverige = "#047FA4",
  danmark = "#C68803",
  utland = "#38A389",
  nor_nett = "#6996CE",
  utland_nett = "#366558"
)



# Start tomt highchart-objekt (riktig funksjon!)
h_snus <- highchart() %>%
  hc_chart(type = "spline") %>%
  hc_title(text = "Fordeling av siste døgns snusforbruk blant dagligsnusere fra ulike kilder") %>%
  hc_subtitle(text = "Fordeling av forsyningskilder til snus over tid") %>%
  hc_xAxis(
   # title = list(text = "?r"),
    categories = dt_snus$aar,
    tickmarkPlacement = "on"
  ) %>%
  hc_yAxis(
  # title = list(text = "Andel (%)"),
    labels = list(format = "{value}%"),
    min = 0
  ) %>%
  hc_tooltip(shared = TRUE, valueSuffix = " %") %>%
  hc_legend(align = "center", verticalAlign = "bottom") %>%
  hc_exporting(enabled = TRUE) %>%
  hc_credits(enabled = FALSE)

# Legg til serier
for (nm in andel_cols) {
  h_snus <- h_snus %>% hc_add_series(
    name   = labels_map[[nm]],
    data   = dt_snus[[nm]],     # rådata, uavrundet
    color  = cols[[nm]],
    marker = list(enabled = TRUE, radius = 3),
    tooltip = list(valueDecimals = 2)  # kun visning
  )
}

h_snus



## Vektede tall:

# Vektede summer per år

sum_snus_year_w <- forsnus[
  ,
  {
    w <- W1
    comp_sums_w <- lapply(.SD, function(x) sum(x * w, na.rm = TRUE))
    tot_sum_w   <- sum(totnsnus * w, na.rm = TRUE)
    N_val       <- sum(rowSums(.SD, na.rm = TRUE) > 0)  # evt. vektet N er ikke standard

    if (tot_sum_w == 0) {
      andeler_w <- list(
        nor=0, taxfree=0, smu=0, sverige=0, danmark=0, utland=0, nor_nett=0, utland_nett=0
      )
    } else {
      andeler_w <- list(
        nor          = 100 * comp_sums_w$An2.1 / tot_sum_w,
        taxfree      = 100 * comp_sums_w$An2.2 / tot_sum_w,
        smu          = 100 * comp_sums_w$An2.3 / tot_sum_w,
        sverige      = 100 * comp_sums_w$An2.4 / tot_sum_w,
        danmark      = 100 * comp_sums_w$An2.5 / tot_sum_w,
        utland       = 100 * comp_sums_w$An2.6 / tot_sum_w,
        nor_nett     = 100 * comp_sums_w$An2.7 / tot_sum_w,
        utland_nett  = 100 * comp_sums_w$An2.8 / tot_sum_w
      )
    }

    c(comp_sums_w, list(N = N_val, sum_totnsnus = tot_sum_w), andeler_w)
  },
  by = aar,
  .SDcols = sum_vars_snus]

  
# Tall til figuren over:
snus_uvektet <- gt(dt_snus) |>  tab_header(title = "Forsyningskilder snus uvektet") |> fmt_number(columns = c(nor, taxfree, smu, sverige, danmark, utland, nor_nett, utland_nett), decimals = 1) |> cols_label(aar = "År", nor = "Norge (butikk)", taxfree = "Taxfree", smu = "Smuglevare", sverige = "Sverige (butikk)", danmark = "Danmark (butikk)", utland = "Utland", nor_nett = "Norge (nett)", utland_nett = "Utland (nett)", sum_totnsnus = "N snus")
  
  
# --- Vektet figur: andeler over tid (fra sum_snus_year_w) ---

# Sikre data.table og år som numerisk
dt_snus_w <- as.data.table(sum_snus_year_w)
if (!is.numeric(dt_snus_w$aar)) dt_snus_w[, aar := as.integer(aar)]
setorder(dt_snus_w, aar)


# Start tomt highchart-objekt
h_snus_w <- highchart() %>%
  hc_chart(type = "spline") %>%
  hc_title(text = "Fordeling av siste døgns snusforbruk (vektet) blant dagligsnusere fra ulike kilder") %>%
  hc_subtitle(text = "Vektede andeler av forsyningskilder til snus over tid") %>%
  hc_xAxis(
    categories = dt_snus_w$aar,
    tickmarkPlacement = "on"
  ) %>%
  hc_yAxis(
    labels = list(format = "{value}%"),
    min = 0
  ) %>%
  hc_tooltip(shared = TRUE, valueSuffix = " %") %>%
  hc_legend(align = "center", verticalAlign = "bottom") %>%
  hc_exporting(enabled = TRUE) %>%
  hc_credits(enabled = FALSE)

# Legg til ?n serie per kilde
for (nm in andel_cols) {
  h_snus_w <- h_snus_w %>% hc_add_series(
    name   = labels_map[[nm]],
    data   = dt_snus_w[[nm]],     # rådata, uavrundet
    color  = cols[[nm]],
    marker = list(enabled = TRUE, radius = 3),
    tooltip = list(valueDecimals = 2)  # kun visning
  )
}

# Vis figuren
h_snus_w


# Tall til figuren over:
snus_vektet <- gt(dt_snus_w) |>  tab_header(title = "Forsyningskilder snus vektet") |> fmt_number(columns = c(nor, taxfree, smu, sverige, danmark, utland, nor_nett, utland_nett), decimals = 1) |> cols_label(aar = "År", nor = "Norge (butikk)", taxfree = "Taxfree", smu = "Smuglevare", sverige = "Sverige (butikk)", danmark = "Danmark (butikk)", utland = "Utland", nor_nett = "Norge (nett)", utland_nett = "Utland (nett)", sum_totnsnus = "N snus")





snus_vektet <- dt_snus_w |>
  select(
    aar, 
    nor, taxfree, smu, sverige, danmark, 
    utland, nor_nett, utland_nett
  ) |>
  gt() |>
  tab_header(
    title = "Forsyningskilder snus vektet"
  ) |>
  fmt_number(
    columns = c(
      nor, taxfree, smu, sverige, danmark,
      utland, nor_nett, utland_nett
    ),
    decimals = 1
  ) |>
  cols_label(
    aar = "År",
    nor = "Norge (butikk)",
    taxfree = "Taxfree",
    smu = "Smuglevare",
    sverige = "Sverige (butikk)",
    danmark = "Danmark (butikk)",
    utland = "Utland",
    nor_nett = "Norge (nett)",
    utland_nett = "Utland (nett)"
  )

snus_vektet


# Lagre tabeller som excel-filer:

library(dplyr)
library(writexl)

  # RØYK, vektet:
dt_w_export <- dt_w |>
  select(
    aar, N, sum_totnroyk,
    nor, taxfree, smu, sverige, danmark,
    utland, nor_nett, utland_nett
  )

write_xlsx(dt_w_export, "O:/Prosjekt/Rusdata/Forsyningsundersokelsen/Data_Forsyn_2015_2024/Analyser 2025/royk_vektet.xlsx")


  # SNUS, vektet:
dt_snus_w_export <- dt_snus_w |>
  select(
    aar, N, sum_totnsnus,
    nor, taxfree, smu, sverige, danmark,
    utland, nor_nett, utland_nett
  )

write_xlsx(dt_snus_w_export, "O:/Prosjekt/Rusdata/Forsyningsundersokelsen/Data_Forsyn_2015_2024/Analyser 2025/snus_vektet.xlsx")



```

#### Figur: Prosentandel av siste døgns snusforbruk blant dagligsnusere som ble kjøpt fra ulike kilder (uvektet), 2015-2025, personer i alderen 16-74 år.

`r h_snus`

#### Figur B: Prosentandel av siste døgns snusforbruk blant dagligsnusere som ble kjøpt fra ulike kilder (vektet), 2015-2025, personer i alderen 16-74 år.

`r h_snus_w`

## Forsyningskilder e-sigaretter

Vi publiserer ikke forsyningskilder til e-sigaretter grunnet reglene som tilsier at dette ikke er lov å kjøpe i Norge og vi ikke kjenner hvem som ev. har importert det grunnet legeerklæring. Tobakksdirektivet skal innføres i mars 2026.

Frem til og med 2023 ble det stilt to spørsmål ifm forsyningskilder til e-sigaretter. Det var:

-   På hvilken måte skaffet du deg den e-sigaretten du bruke sist? (Ae3OLD)
-   På hvilken måte skaffet du deg væsken (e-juicen) i den esigaretten du brukte sist? (Ae3_1OLD)

Fra og med 2024 ble disse to spørsmålene erstattet med følgende:

-   Hvordan skaffer du deg vanligvis din ferdige utblandet nikotinvæske? (e3a)
-   Hvordan skaffer du deg den nikotinvæsken som blandes inn i en smaksvæske? (e3b)
-   Hvordan skaffer du deg vanligvis smaksvæske? (e3c) Samme filter som e3b.
-   Hvordan skaffer du deg vanligvis engangsvapen/disposable? (e3d)
-   Hvordan skaffer du deg vanligvis e-sigaretten/fordamperenheten med påfyllingsmulighet? OBS på at alle disse har filter knyttet til seg.

Svaralternativene på spørsmålene over er like, både før og etter 2023/2024.

```{r}
#| include: false
#| echo: false
#| output: false
#| message: false

# AVVENTER MED DETTE SIDEN DET ER USIKKERT HVA DET ER AVGIFT PÅ OG IKKE: 
# https://www.skatteetaten.no/bedrift-og-organisasjon/avgifter/saravgifter/om/tobakk/
  

# Lager datasett med kun dagligrøykere (e-sig).
  # OBS. Indivder >74 og <16 er allerede fjernet fra for_2025, hvis ikke må de fjernes her.


# Variabelnavnene du vil beholde
# vars_damp <- c(
#   "kjonn", "alder", "W1", "aar", "alder_4", 
#   "Aq3", "Ae1", "Ae2", 
#   "e2b", "e3a", "e3b", "e3c", "e3d", "e3f",
#   "Ae3OLD", "Ae3_1OLD"
# )
# 
# 
# 
# ### FOrdamperenhet - forsyning
# 
# # Fordamperhet forsyning. Lag nytt datasett med filtrering og variabelutvalg på de som røyker e-sig daglig. Dette brukes kun til forsyning på fordamperenhet. 
# fordamp_enhet <- for_2025[Aq3 == 1, ..vars_damp] 
# 
#  # For e-sig engangs eller enhet med påfylling er det to variabler. Dobbeltsjekker at ikke ett individ har svart på begge variablene, selv om filter tilsier at dette ikke skal skje
# 
# # Lager indikatorvariabel: 1 hvis begge er ikke-NA, ellers 0
# fordamp_enhet[, enhet_begge_ikke_mis := as.integer(!is.na(e3d) & !is.na(e3f))]
# 
# # Teller antall rade der indikatoren er 1
# antall_begge_ikke_mis <- fordamp_enhet[, sum(enhet_begge_ikke_mis)]
# 
# # Antall:
# antall_begge_ikke_mis
# 
# # Kombinerer forsyningskilde for enhet (engangs og m/påfylling) til en variabel, inkl. tidligere stilt spørsmål til en variabel:
# fordamp_enhet[, enhet := apply(.SD, 1, function(x) paste(na.omit(x), collapse = " ")),
#               .SDcols = c("Ae3OLD", "e3d", "e3f")] # Denne legger inn flere verdier i tekst-streng.
# # Lager variabel til numerisk:
# fordamp_enhet[, enhet := as.numeric(enhet)]
# fordamp_enhet[is.na(as.numeric(enhet)), .N]  # teller antall som blir N
# 
# # Lager tabell med forsyning for enhet (både engangs og påfyllbar) over tid:
# 
# # Legger inn alternativer, 1-7 (obs, alt 7 kun svaralternativ for e3f):
# 
# # 1) Definer kategorinavn for verdiene 1–7
# enhet_labels <- c(
#   "Utsalg Norge",           # 1
#   "Nett Norge",             # 2
#   "Utsalg Sverige/Danmark", # 3
#   "Utsalg utland",          # 4
#   "Nett Sverige/Danmark",   # 5
#   "Nett utland",            # 6
#   "Annet/usikker"           # 7
# )
# 
# # 2) Lag en kategorivariabel med labels (kun for 1:7)
# fordamp_enhet[
#   , enhet_kat := factor(enhet, levels = 1:7, labels = enhet_labels)
# ]
# 
# # 3) Frekvenstabell per år, ekskluder NA og andre verdier enn 1:7
# tab_enhet_aar <- fordamp_enhet[
#   !is.na(enhet),
#   .(n = .N), 
#   by = .(aar, enhet, enhet_kat)
# ][
#   # 5) Andel per år (andel = n / sum(n) for samme aar)
#   , andel := n / sum(n), by = aar
# ][
#   # 6) Valgfritt: legg til prosent og sorter
#   , andel_prosent := round(100 * andel, 1)
# ][
#   order(aar, enhet)
# ]
# 
# # tar med n per år
# total_per_aar <- fordamp_enhet[!is.na(enhet), .(N_total = .N), by = aar]
# 
# 
# # Lage figur: 
# 
# 
# library(data.table)
# library(highcharter)
# 
# # Sikre at tabellen har andel (0–1) og riktig sortering
# tab_plot <- copy(tab_enhet_aar)[order(aar, enhet_kat)]
# 
# # Velg farger (valgfritt)
# farger <- c(
#   "Utsalg Norge"           = "#025169",
#   "Nett Norge"             = "#0069E8", 
#   "Utsalg Sverige/Danmark" = "#7C145C",
#   "Utsalg utland"          = "#047FA4",
#   "Nett Sverige/Danmark"   = "#C68803",
#   "Nett utland"            = "#38A389",
#   "Annet/usikker"          = "#6996CE"
# )
# 
# library(highcharter)
# 
# 
# # Alle år (x-aksen)
# alle_aar <- sort(unique(tab_plot$aar))
# 
# # Fikse: 
# # i figuren er det 2 linjer av hver variabel..
# 
# 
# # Start chart
# hc_linje <- highchart() %>%
#   hc_title(text = "Forsyningskilde e-sigarett-enhet over tid") %>%
#  # hc_subtitle(text = "NA utelatt; enhet 1–7") %>%
#   hc_xAxis(
#     title = list(text = "År"),
#     categories = alle_aar,
#     tickmarkPlacement = "on"
#   ) %>%
#   hc_yAxis(
#    # title = list(text = "Andel (%)"),
#     max = 100, min = 0
#   ) %>%
#   hc_tooltip(
#     shared = TRUE,
#     # Kun prosent i tooltip, med to desimaler:
#     pointFormat = "<span style='color:{series.color}'>●</span> {series.name}: <b>{point.y:.2f} %</b><br/>"
#   ) %>%
#   hc_legend(enabled = TRUE) %>%
#   hc_exporting(enabled = TRUE)
# 
# # Legg til én serie per kategori (y-verdier i prosent)
# for (kat in unique(tab_plot$enhet_kat)) {
#   dt <- tab_plot[enhet_kat == kat, .(aar, y = andel * 100)]  # konverter til prosent
#   # Sørg for samme lengde/rekkefølge som x-aksen (alle_aar)
#   dt_full <- data.table(aar = alle_aar)[dt, on = "aar"]
#   dt_full[is.na(y), y := 0]
# 
#   hc_linje <- hc_linje %>%
#     hc_add_series(
#       name  = as.character(kat),
#       data  = dt_full$y,  # numerisk vektor i prosent
#       type  = "spline",
#       color = farger[[as.character(kat)]],
#       marker = list(enabled = TRUE)
#     )
# }
# 
# hc_linje
# 
# 
#   
# 
# 
# # E-sig væske forsyning (med nikotin)
# # Lag nytt datasett med filtrering og variabelutvalg på de som røyker e-sig daglig, svarer hvilken type e-sig de bruker (filtreringsspørsmål) og kutter de som røyker nikotinfri væske eller ikke vet nikotininnhold i væsken. Dette brukes kun til forsyning på væske. 
# 
# 
# # Lag nytt datasett med filtrering og variabelutvalg på de som røyker e-sig daglig. Dette brukes kun til forsyning på fordamperenhet. 
# fordamp_fluid <- for_2025[Aq3 == 1, ..vars_damp] 
# 
#  # For væske er det flere variabler, og etter 2023 er det to variabler (ferdigutblandet nikotinholdig væske og nikotinvæske som blandes inn selv). Dobbeltsjekker at ikke ett individ har svart på begge variablene, selv om filter tilsier at dette ikke skal skje.
# 
# # Lager indikatorvariabel: 1 hvis begge er ikke-NA, ellers 0
# fordamp_fluid[, enhet_begge_ikke_mis := as.integer(!is.na(e3a) & !is.na(e3b))]
# 
# # Teller antall rade der indikatoren er 1
# antall_begge_ikke_mis <- fordamp_fluid[, sum(enhet_begge_ikke_mis)]
# 
# # Antall:
# antall_begge_ikke_mis
# 
# # Kombinerer forsyningskilde for enhet (engangs og m/påfylling) til en variabel, inkl. tidligere stilt spørsmål til en variabel:
# fordamp_fluid[, fluid := apply(.SD, 1, function(x) paste(na.omit(x), collapse = " ")),
#               .SDcols = c("Ae3_1OLD", "e3a", "e3b")] # Denne legger inn flere verdier i tekst-streng.
# # Lager variabel til numerisk:
# fordamp_fluid[, fluid := as.numeric(fluid)]
# fordamp_fluid[is.na(as.numeric(fluid)), .N]  # teller antall som blir N
# 
# 
# # Lager tabell med forsyning for væske (ferdigutblandet og nikotinvæske som blandes inn) over tid:
# 
# # Legger inn alternativer, 1-7 (obs, alt 7 kun svaralternativ for e3f):
# 
# # 2) Lag en kategorivariabel med labels (kun for 1:7)
# fordamp_fluid[
#   , enhet_kat := factor(fluid, levels = 1:7, labels = enhet_labels)
# ]
# 
# # 3) Frekvenstabell per år, ekskluder NA og andre verdier enn 1:7
# tab_enhet_aar <- fordamp_fluid[
#   !is.na(fluid),
#   .(n = .N), 
#   by = .(aar, fluid, enhet_kat)
# ][
#   # 5) Andel per år (andel = n / sum(n) for samme aar)
#   , andel := n / sum(n), by = aar
# ][
#   # 6) Valgfritt: legg til prosent og sorter
#   , andel_prosent := round(100 * andel, 1)
# ][
#   order(aar, fluid)
# ]
# 
# # tar med n per år
# total_per_aar <- fordamp_fluid[!is.na(fluid), .(N_total = .N), by = aar]
# 
# 
# # Lage figur: 
# 
# 
# library(data.table)
# library(highcharter)
# 
# # Sikre at tabellen har andel (0–1) og riktig sortering
# tab_plot_fluid <- copy(tab_enhet_aar)[order(aar, enhet_kat)]
# 
# 
# # Alle år (x-aksen)
# alle_aar <- sort(unique(tab_plot_fluid$aar))
# 
# # Fikse: 
# # i figuren er det 2 linjer av hver variabel..
# 
# 
# # Start chart
# hc_linje_fluid <- highchart() %>%
#   hc_title(text = "Forsyningskilde e-sigarett nikotinvæske over tid") %>%
#  # hc_subtitle(text = "NA utelatt; enhet 1–7") %>%
#   hc_xAxis(
#     title = list(text = "År"),
#     categories = alle_aar,
#     tickmarkPlacement = "on"
#   ) %>%
#   hc_yAxis(
#    # title = list(text = "Andel (%)"),
#     max = 100, min = 0
#   ) %>%
#   hc_tooltip(
#     shared = TRUE,
#     # Kun prosent i tooltip, med to desimaler:
#     pointFormat = "<span style='color:{series.color}'>●</span> {series.name}: <b>{point.y:.2f} %</b><br/>"
#   ) %>%
#   hc_legend(enabled = TRUE) %>%
#   hc_exporting(enabled = TRUE)
# 
# # Legg til én serie per kategori (y-verdier i prosent)
# for (kat in unique(tab_plot_fluid$enhet_kat)) {
#   dt <- tab_plot[enhet_kat == kat, .(aar, y = andel * 100)]  # konverter til prosent
#   # Sørg for samme lengde/rekkefølge som x-aksen (alle_aar)
#   dt_full <- data.table(aar = alle_aar)[dt, on = "aar"]
#   dt_full[is.na(y), y := 0]
# 
#   hc_linje_fluid <- hc_linje_fluid %>%
#     hc_add_series(
#       name  = as.character(kat),
#       data  = dt_full$y,  # numerisk vektor i prosent
#       type  = "spline",
#       color = farger[[as.character(kat)]],
#       marker = list(enabled = TRUE)
#     )
# }
# 
# hc_linje_fluid
# 


```

```{r}

```

# Kodebok

```{r}
#| echo: false
#| message: false

# Lager kodeboka som eksporteres manuelt:
create_codebook(for_2025)


```
